# halyavino_board
В этом репозитории содержится исходный код прошивки для платы halyavino.
![Alt text](board_image.png?raw=true "Изображение платы")
1) Микроконтроллер stm32f103. Для конфигурации и управления периферией используется библиотека HAL (генерированная с помощью CubeMX)/
2) Разъём USB, через него посредством прошивки должна осуществляться загрузка файлов в SPI_flash. 
Поскольку винда не даёт запускать какие угодно драйверы, используется тип устройства USB_HID
3) SPI-flash - хранит файлы, поределяющие режим работы конкретной куклы. В том числе: 
-файлы .led - для 6 силовых каналов светодиодов; 
-файлы .srv - для сервоприводов;
-файлы .wav - для звука;
-файлы .gpio - для GPIO портов в режиме output;
-другие(конфигурация оборудования,  скрипты для одновременного запуска).
Для хранения файлов используется файловая система, поддерживаемая библиотекой FAT_FS
4) Разъём для неизвлекаемой из куклы периферии (светодиоды и динамик - всё то что, вероятно, придётся вклеивать)
5) GPIO - разъём. Порты Должны поддерживать 4 режима работы, но пока хотя бы 3: выход, вход и сервопривод. 
В режиме входа генерируют системные события, запускающие скрипты (или отдельные файлы)
6) Резистивный ЦАП для звука
7) Плата усилителя (здесь ещё не припаяна)
8) Разъём питания (напряжение 3.7-5 вольт, на выходе преобразователя стабилизированные 5 вольт)
9) Разъём внешнего цифрового устройства (пока можно забить, оставить на дальнейшее развитие)
10) Отладочный разъём  
Негенерированные каталоги в этой папке:
-board_halyavino_lib
-spi_flash
-system
Также есть изменения, внесённые в каталоге SRC

Список того что нужно сделать, чтобы первая версия заработала - в файле to-do.txt
